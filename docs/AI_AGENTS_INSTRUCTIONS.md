# ü§ñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è GitHub Copilot –∏ AI-–∞–≥–µ–Ω—Ç–æ–≤

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–º–ø—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤, –ø–æ–º–æ–≥–∞—é—â–∏—Ö –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–∏—Å—Ç–µ–º—ã TrackerGPS.

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è](#–ø—Ä–∞–≤–∏–ª–∞-–æ–±—â–µ–Ω–∏—è)
2. [–ü—Ä–∞–≤–∏–ª–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–æ–¥–∞](#–ø—Ä–∞–≤–∏–ª–∞-–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è-–∫–æ–¥–∞)
3. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (–§–ü)](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ)
4. [–û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã](#–æ–±—â–∏–µ-–ø—Ä–∏–Ω—Ü–∏–ø—ã)
5. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
6. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
7. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
8. [–ü—Ä–æ–º–ø—Ç—ã –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º](#–ø—Ä–æ–º–ø—Ç—ã-–ø–æ-—Å–µ—Ä–≤–∏—Å–∞–º)
9. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É](#–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏-–ø–æ-–∫–∞—á–µ—Å—Ç–≤—É)

---

## üó£Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –æ–±—â–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

‚úÖ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**
- **–í—Å–µ–≥–¥–∞ –æ–±—â–∞—Ç—å—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ** ‚Äî –≤–µ—Å—å —Ç–µ–∫—Å—Ç, –æ—Ç–≤–µ—Ç—ã, –ø–æ—è—Å–Ω–µ–Ω–∏—è
- **–í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, TODO
- **–ë–µ–∑ —á–µ—Ç–∫–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –Ω–µ –ø–∏—Å–∞—Ç—å –∫–æ–¥** ‚Äî —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –í—Å–µ –∞–Ω–∞–ª–∏–∑—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ Markdown-—Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –°—Ç–∏–ª—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

- **–ö—Ä–∞—Ç–∫–æ—Å—Ç—å –∏ —è—Å–Ω–æ—Å—Ç—å**: –æ—Ç–≤–µ—á–∞—Ç—å –∫—Ä–∞—Ç–∫–æ, –Ω–æ —Å –ø–æ–ª–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è**: –≤—Å–µ–≥–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- **–£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã**: –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ—è—Å–Ω–æ, —Å—Ä–∞–∑—É –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ Markdown-—Ñ–∞–π–ª—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º
- **–†–∞–∑–±–∏–µ–Ω–∏–µ –∑–∞–¥–∞—á**: –¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –ø–æ–¥—à–∞–≥–∏, –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è —Å–¥–µ–ª–∞—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å, –≤—Å—ë –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–∏–º–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –î–æ–±–∞–≤—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è IMEI

‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
def validateImei(imei: String): Boolean = imei.length == 15

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
–Ø –ø–æ–Ω–∏–º–∞—é, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é IMEI. IMEI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 15 —Ü–∏—Ñ—Ä.
–ü—Ä–µ–¥–ª–∞–≥–∞—é:
1. –°–æ–∑–¥–∞—Ç—å sealed trait –¥–ª—è –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Either[ValidationError, String]
3. –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã

–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω—è–ª —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è?
```

---

## üíª –ü—Ä–∞–≤–∏–ª–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–æ–¥–∞

### –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–Ω—Ç–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –≥–∞–π–¥–ª–∞–π–Ω–∞–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞/—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
- **–í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ**
- **–ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—â–∏–º—Å—è** ‚Äî –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞, —Ç–∏–ø—ã —è–≤–Ω—ã–µ
- **DRY –ø—Ä–∏–Ω—Ü–∏–ø** ‚Äî –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –∫–æ–¥, —Å–æ–∑–¥–∞–≤–∞–π —É—Ç–∏–ª–∏—Ç—ã
- **KISS –ø—Ä–∏–Ω—Ü–∏–ø** ‚Äî –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```scala
// ‚úÖ –•–æ—Ä–æ—à–æ: –ª–æ–≥–∏—á–Ω–æ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ, –ø–æ–Ω—è—Ç–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è
def processDevice(id: Long): Task[Device] = for {
  // –ü–æ–ª—É—á–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑ –±–∞–∑—ã
  device <- deviceRepository.findById(id)
    .someOrFail(DeviceNotFound(id))
  
  // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
  validated <- validateDevice(device)
  
  // –õ–æ–≥–∏—Ä—É–µ–º
  _ <- logAction(s"Processing device $id")
} yield validated

// ‚ùå –ü–ª–æ—Ö–æ: –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –Ω–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ
def processDevice(id: Long): Task[Device] = for {
  device <- deviceRepository.findById(id).someOrFail(DeviceNotFound(id))
  validated <- validateDevice(device)
  _ <- logAction(s"Processing device $id")
} yield validated
```

---

## üîß –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (–§–ü)

### –ü—Ä–∞–≤–∏–ª–æ #1: Immutability (–ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º val, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã
case class User(id: Long, name: String, email: String)

val user = User(1, "Ivan", "ivan@example.com")
val updatedUser = user.copy(name = "Ivan Petrov")

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: var - –∑–∞–ø—Ä–µ—â–µ–Ω–æ!
var user = User(1, "Ivan", "ivan@example.com")
user.name = "Ivan Petrov"  // –û–®–ò–ë–ö–ê!
```

### –ü—Ä–∞–≤–∏–ª–æ #2: Pure Functions (–ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –Ω–µ—Ç side effects, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∞
def calculateDistance(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Double = {
  // –¢–æ–ª—å–∫–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –Ω–∏–∫–∞–∫–∏—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lon2 - lon1, 2))
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ø–µ—á–∞—Ç–∞–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å (side effect)
def calculateDistance(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Double = {
  val result = Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lon2 - lon1, 2))
  println(s"Distance: $result")  // Side effect!
  result
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
var maxDistance = 0.0
def calculateDistance(lat1: Double, lon1: Double, lat2: Double, lon2: Double): Double = {
  val result = Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lon2 - lon1, 2))
  if (result > maxDistance) maxDistance = result  // Mutation!
  result
}
```

### –ü—Ä–∞–≤–∏–ª–æ #3: Composition (–ö–æ–º–ø–æ–∑–∏—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Å–æ—Å—Ç–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —á–∏—Å—Ç—ã—Ö –±–ª–æ–∫–æ–≤
def processLocation(location: Location): Task[EnrichedLocation] = for {
  // –ö–∞–∂–¥—ã–π —à–∞–≥ - —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–ª–∏ IO-–º–æ–Ω–∞–¥–∞
  validated <- validateLocation(location)
  enhanced <- enrichLocationWithAltitude(validated)
  cached <- cacheLocation(enhanced)
} yield cached

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Ñ—É–Ω–∫—Ü–∏—è –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞
def withValidation[A, B](f: A => Task[B]): A => Task[B] = { a =>
  for {
    _ <- validate(a)
    result <- f(a)
  } yield result
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: —Å–ª–æ–∂–Ω—ã–π if-else –≤–º–µ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
def processLocation(location: Location): Task[EnrichedLocation] = {
  if (!isValid(location)) {
    ZIO.fail(InvalidLocation)
  } else {
    enrichLocationWithAltitude(location).flatMap(cacheLocation(_))
  }
}
```

### –ü—Ä–∞–≤–∏–ª–æ #4: Functor Laws (–ó–∞–∫–æ–Ω—ã —Ñ—É–Ω–∫—Ç–æ—Ä–æ–≤)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º map, flatMap –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
val devices: List[Device] = getDevices()
val names: List[String] = devices.map(_.name)
val statuses: Task[List[String]] = 
  ZIO.foreach(devices)(d => getDeviceStatus(d.id).map(_.toString))

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ –≤–º–µ—Å—Ç–æ –º–æ–Ω–∞–¥–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–¥–∞
val result = for {
  d <- devices
  s <- getDeviceStatus(d.id)
  n <- getNotifications(d.id)
} yield (d, s, n)
// –≠—Ç–æ —É–∂–µ –ª—É—á—à–µ, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–∏–ø–∞
```

### –ü—Ä–∞–≤–∏–ª–æ #5: –ò–∑–±–µ–≥–∞–Ω–∏–µ Null (Null Safety)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º Option –≤–º–µ—Å—Ç–æ null
def getUserName(userId: Long): Task[Option[String]] = for {
  user <- userRepository.findById(userId)
} yield user.map(_.name)

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º Either –¥–ª—è –æ—à–∏–±–æ–∫
def getUserName(userId: Long): Task[Either[UserNotFound, String]] = for {
  user <- userRepository.findById(userId)
    .map(_.toRight(UserNotFound(userId)))
} yield user.map(_.name)

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
def getUserName(userId: Long): String = {
  val user = userRepository.find(userId)
  if (user != null) user.name else null  // Danger!
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: unsafe .get()
val name = users.find(_.id == userId).get  // –ú–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
```

### –ü—Ä–∞–≤–∏–ª–æ #6: Type Safety (–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —è–≤–Ω—ã–µ —Ç–∏–ø—ã –≤–µ–∑–¥–µ
def createDevice(
  imei: String,
  organizationId: Long,
  protocol: Protocol
): Task[Device] = ???

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º newtype –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
opaque type IMEI = String
opaque type OrganizationId = Long

def createDevice(imei: IMEI, organizationId: OrganizationId): Task[Device] = ???

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –Ω–µ—è–≤–Ω—ã–µ —Ç–∏–ø—ã, –ª–µ–≥–∫–æ –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
def createDevice(x: String, y: Long, z: String): Task[Device] = ???
```

### –ü—Ä–∞–≤–∏–ª–æ #7: Error Handling (–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
sealed trait AppError extends Throwable
case class DeviceNotFound(id: Long) extends AppError
case class InvalidImei(imei: String) extends AppError

def getDevice(id: Long): Task[Device] =
  repository.findById(id).someOrFail(DeviceNotFound(id))

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
def handler: HttpApp[DeviceService] = Http.collectZIO[Request] {
  case req @ (Method.GET -> ...) =>
    handler(req)
      .catchSome {
        case DeviceNotFound(id) => 
          ZIO.succeed(Response.notFound(s"Device $id not found"))
        case InvalidImei(imei) => 
          ZIO.succeed(Response.badRequest(s"Invalid IMEI: $imei"))
      }
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ª–æ–≤–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫, –ø–æ—Ç–µ—Ä—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
try {
  repository.findById(id).orElse(null)
} catch {
  case e: Exception => null
}
```

---

## ÔøΩÔ∏è Scala: Best Practices

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

- **Scala –≤–µ—Ä—Å–∏—è:** 3.4.0+
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** scalafmt —Å –∫–æ–Ω—Ñ–∏–≥–æ–º –ø—Ä–æ–µ–∫—Ç–∞
- **–°—Ç–∏–ª—å:** [Scala Style Guide](https://docs.scala-lang.org/style/)
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ:**
  - `camelCase` –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  - `PascalCase` –¥–ª—è –∫–ª–∞—Å—Å–æ–≤, —Ç—Ä–µ–π—Ç–æ–≤, case classes
  - SCREAMING_SNAKE_CASE –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç
  - `_` –¥–ª—è unused –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º for comprehension —Å ZIO
def processDevices(organizationId: Long): Task[List[ProcessedDevice]] = for {
  // –ü–æ–ª—É—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  devices <- deviceRepository.listByOrganization(organizationId)
  
  // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥–æ–µ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
  processed <- ZIO.foreach(devices)(processDevice)
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—Ö
  _ <- ZIO.logInfo(s"Processed ${processed.length} devices")
} yield processed

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞
def withTimeout[A](duration: Duration)(task: Task[A]): Task[A] =
  task.timeout(duration)
    .catchSome {
      case Some(_) => ZIO.fail(TimeoutError)
    }

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å —Å var
def processDevices(organizationId: Long): Task[List[ProcessedDevice]] = {
  var devices = scala.collection.mutable.ListBuffer[Device]()
  var processed = scala.collection.mutable.ListBuffer[ProcessedDevice]()
  
  for {
    d <- deviceRepository.listByOrganization(organizationId)
  } yield {
    devices += d
    for (dev <- devices) {
      processed += processDevice(dev).toBlocking.get  // Blocking!
    }
    processed.toList
  }
}
```

### Pattern Matching

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: exhaustive pattern matching
def handleCommandStatus(status: CommandStatus): String = status match {
  case CommandStatus.Pending => "–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏"
  case CommandStatus.Sent => "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞"
  case CommandStatus.Success => "–£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞"
  case CommandStatus.Error(msg) => s"–û—à–∏–±–∫–∞: $msg"
  case CommandStatus.Timeout => "–¢–∞–π–º–∞—É—Ç"
  // –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –µ—Å–ª–∏ –∑–∞–±—ã—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç
def handleCommandStatus(status: CommandStatus): String = {
  if (status == CommandStatus.Pending) "–û–∂–∏–¥–∞–Ω–∏–µ"
  else if (status == CommandStatus.Sent) "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞"
  // –ó–∞–±—ã–ª–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã!
}
```

### –¢–∏–ø–∏–∑–∞—Ü–∏—è

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —è–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
def findDevice(id: Long): Task[Option[Device]] =
  deviceRepository.findById(id)

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º type aliases –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
type DeviceResult = Task[Either[AppError, Device]]

def getDevice(id: Long): DeviceResult =
  deviceRepository.findById(id)
    .map(_.toRight(DeviceNotFound(id)))

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –Ω–µ—è–≤–Ω—ã–µ —Ç–∏–ø—ã (Scala –≤—ã–≤–µ–¥–µ—Ç, –Ω–æ –∫–æ–¥ –º–µ–Ω–µ–µ —è—Å–µ–Ω)
def findDevice(id) = deviceRepository.findById(id)
```

### –ö–ª–∞—Å—Å—ã –∏ Case Classes

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: case class –¥–ª—è data
case class Device(
  id: Long,
  imei: String,
  name: String,
  organizationId: Long,
  enabled: Boolean = true,
  createdAt: Instant = Instant.now()
)

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: sealed trait –¥–ª—è —Ç–∏–ø–æ–≤
sealed trait Protocol:
  def name: String

case object TeltonikaProtocol extends Protocol:
  def name = "teltonika"

case object WialonProtocol extends Protocol:
  def name = "wialon"

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –æ–±—ã—á–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è simple data
class Device {
  var id: Long = 0
  var imei: String = ""
  var name: String = ""
  // ...
}
```

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

```scala
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Scaladoc –¥–ª—è public API
/** 
  * –ü–æ–ª—É—á–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ ID.
  * 
  * @param id ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  * @return Task —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º
  * @throws DeviceNotFound –µ—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
  */
def findDevice(id: Long): Task[Option[Device]] = ???

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—ã—à–µ –∫–æ–¥–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –∏–º–µ–Ω–∏
val activeDevices = devices.filter(_.enabled).sortBy(_.name)

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
def calculateRoute(locations: List[Location]): List[RouteSegment] = {
  // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É
  // (–º–µ–Ω–µ–µ 10 –º–µ—Ç—Ä–æ–≤), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —à—É–º–æ–≤ GPS
  val filtered = locations.sliding(2)
    .filter { case Seq(a, b) => distance(a, b) > 10.0 }
    .map(_.head)
    .toList
  
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤ —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏
  filtered.groupConsecutiveBy(_.speed).map(...)
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –æ—á–µ–≤–∏–¥–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
val x = 5 // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è x —Ä–∞–≤–Ω–∞ 5
val names = devices.map(_.name) // –ü–æ–ª—É—á–∏—Ç—å –∏–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
```

---

## üìù –í–∞–∂–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

1. **–ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∫–æ–¥ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞** ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ —á–µ—Ç–∫–æ–º—É —É–∫–∞–∑–∞–Ω–∏—é
2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º** ‚Äî –≤ –∫–æ–¥–µ, –≤ PR, –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö
3. **–†–∞–∑–±–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —ç—Ç–∞–ø—ã** ‚Äî –¥–µ–ª–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ
4. **–°–æ–∑–¥–∞–≤–∞—Ç—å Markdown –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞** ‚Äî –ø–µ—Ä–µ–¥ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
5. **–ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å** ‚Äî –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏
6. **–ë—ã—Ç—å —É–ª—å—Ç—Ä–∞ –§–ü-—à–Ω–∏–∫–æ–º** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
7. **–ò–∑–±–µ–≥–∞—Ç—å null, var –∏ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Option, Task, val

---

## ÔøΩüéØ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –†–æ–ª—å AI-–∞–≥–µ–Ω—Ç–∞

–¢—ã ‚Äî **Senior Scala —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫** —Å –æ–ø—ã—Ç–æ–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –¢–≤–æ—è –∑–∞–¥–∞—á–∞:
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- –°–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É —Å—Ç–µ–∫—É –ø—Ä–æ–µ–∫—Ç–∞
- –ü–∏—Å–∞—Ç—å production-ready –∫–æ–¥
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è

### 2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

‚úÖ **MUST DO:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- –°–ª–µ–¥–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º
- –ü–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API (OpenAPI/Swagger)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ ZIO Logger
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ ZIO Either
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dependency injection —á–µ—Ä–µ–∑ ZIO environment

‚ùå **MUST NOT:**
- –ú–µ–Ω—è—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –±–µ–∑ –æ–±—Å—É–∂–¥–µ–Ω–∏—è
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å multi-tenant —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ü–∏—Å–∞—Ç—å –∫–æ–¥ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mutable —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –°–æ–∑–¥–∞–≤–∞—Ç—å tight coupling –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### 3. –°—Ç–∏–ª—å –∫–æ–¥–∞

```scala
// ‚úÖ –•–æ—Ä–æ—à–æ: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, —Ç–∏–ø—ã —è–≤–Ω—ã–µ, –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
def processDevice(id: Long): Task[Device] = for {
  device <- deviceRepository.findById(id)
    .someOrFail(DeviceNotFound(id))
  validated <- validateDevice(device)
  _ <- logAction(s"Processing device $id")
} yield validated

// ‚ùå –ü–ª–æ—Ö–æ: mutable —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–µ—è–≤–Ω—ã–µ —Ç–∏–ø—ã, –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
def processDevice(id: Long) = {
  var device = repo.find(id)
  device.name = "updated"
  device
}
```

### 4. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:
1. –†–∞–∑–±–µ–π –∑–∞–¥–∞—á—É –Ω–∞ —ç—Ç–∞–ø—ã
2. –û–±—ä—è—Å–Ω–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
3. –£–∫–∞–∑—ã–≤–∞–π —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–π –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
5. –ü—Ä–µ–¥–ª–∞–≥–∞–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wayrecall-tracker/
‚îú‚îÄ‚îÄ services/                          # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ connection-manager/            # –ü—Ä–∏—ë–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Ç—Ä–µ–∫–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ device-manager/                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ history-writer/                # –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ analytics-service/             # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îÇ
‚îú‚îÄ‚îÄ shared/                            # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ common/                        # –£—Ç–∏–ª–∏—Ç—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/                        # –û–±—â–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ config/                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ docs/                              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md                # –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md                  # Deploy –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ services/                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml                 # –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ build.sbt                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ README.md
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-----------|
| **Scala** | 3.4.0 | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **ZIO** | 2.0.20 | Async/await, Effect management |
| **zio-http** | 0.0.5 | REST API —Å–µ—Ä–≤–µ—Ä |
| **Doobie** | 1.0.0-RC1 | PostgreSQL JDBC |
| **zio-redis** | 0.2.0 | Redis –∫–ª–∏–µ–Ω—Ç |
| **zio-kafka** | 2.1.1 | Kafka producer/consumer |
| **zio-json** | 0.6.2 | JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è |
| **zio-config** | 4.0.0-RC16 | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| **zio-logging** | 2.1.13 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |

### Infrastructure

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-----------|
| **PostgreSQL** | 15 | –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö |
| **Redis** | 7.0 | –ö–µ—à + Pub/Sub |
| **Kafka** | 3.4 | Event streaming |
| **Docker** | latest | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è |
| **Prometheus** | 2.40 | –ú–µ—Ç—Ä–∏–∫–∏ |
| **Grafana** | 9.0 | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ë–ª–æ–∫–∏ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     TRACKERPS ARCHITECTURE                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  BLOCK 1: DATA COLLECTION (–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)                        ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚Ä¢ Connection Manager    ‚Äî –ü—Ä–∏—ë–º TCP/UDP –æ—Ç —Ç—Ä–µ–∫–µ—Ä–æ–≤          ‚îÇ
‚îÇ  ‚Ä¢ Device Manager        ‚Äî CRUD —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ          ‚îÇ
‚îÇ  ‚Ä¢ History Writer        ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  BLOCK 2: ANALYTICS & INTELLIGENCE (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞)                ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚Ä¢ Analytics Service     ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫–∞, –º–∞—Ä—à—Ä—É—Ç—ã           ‚îÇ
‚îÇ  ‚Ä¢ Geozones Service      ‚Äî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–µ–æ–∑–æ–Ω–∞—Ö              ‚îÇ
‚îÇ  ‚Ä¢ Alert Service         ‚Äî –†–∞–∑–ª–∏—á–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  BLOCK 3: INTEGRATION (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)                             ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚Ä¢ API Gateway           ‚Äî –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤              ‚îÇ
‚îÇ  ‚Ä¢ Auth Service          ‚Äî JWT + RBAC                          ‚îÇ
‚îÇ  ‚Ä¢ Notification Service  ‚Äî Email, SMS, WebSocket               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  COMMON INFRASTRUCTURE                                         ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚Ä¢ PostgreSQL (–≥–ª–∞–≤–Ω–∞—è –ë–î)                                     ‚îÇ
‚îÇ  ‚Ä¢ Redis (–∫–µ—à, Pub/Sub)                                        ‚îÇ
‚îÇ  ‚Ä¢ Kafka (event streaming)                                     ‚îÇ
‚îÇ  ‚Ä¢ Prometheus + Grafana (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)                           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                  ‚îÇ
‚îÇ  –¢—Ä–µ–∫–µ—Ä TCP ‚îÄ‚îÄ‚Üí Connection Manager                              ‚îÇ
‚îÇ                      ‚îÇ                                           ‚îÇ
‚îÇ                      ‚îú‚îÄ‚Üí [Kafka: device-position]               ‚îÇ
‚îÇ                      ‚îú‚îÄ‚Üí [Redis: device-status]                 ‚îÇ
‚îÇ                      ‚îî‚îÄ‚Üí [Redis: commands-out]                  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ                  ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚Üì                     ‚Üì                  ‚Üì                 ‚Üì  ‚îÇ
‚îÇ History Writer   Device Manager    Analytics Service   Geozones ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ                  ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ           ‚îÇ                    ‚îÇ                    ‚îÇ           ‚îÇ
‚îÇ           ‚Üì                    ‚Üì                    ‚Üì           ‚îÇ
‚îÇ      TimescaleDB         PostgreSQL         PostgreSQL          ‚îÇ
‚îÇ           ‚îÇ                    ‚îÇ                    ‚îÇ           ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                     API Gateway                                  ‚îÇ
‚îÇ                          ‚îÇ                                       ‚îÇ
‚îÇ                   Client Applications                            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üé¨ –ü—Ä–æ–º–ø—Ç—ã –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º

### 1Ô∏è‚É£ Connection Manager

> **–ë–ª–æ–∫:** Data Collection  
> **–†–æ–ª—å:** –ü—Ä–∏—ë–º –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Ç—Ä–µ–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ TCP/UDP  
> **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (—Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö)

[–ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ docs/services/CONNECTION_MANAGER.md]

**–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–º–ø—Ç:**
```
–†–µ–∞–ª–∏–∑—É–π Connection Manager ‚Äî —Å–µ—Ä–≤–∏—Å –ø—Ä–∏—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç GPS —Ç—Ä–µ–∫–µ—Ä–æ–≤.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–ª—É—à–∞–µ—Ç TCP –Ω–∞ –ø–æ—Ä—Ç—É 8090 –∏ UDP –Ω–∞ 8091
2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—ã: Teltonika, Wialon, Ruptela, Navtelecom
3. –ü–∞—Ä—Å–∏—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–µ—Ä–æ–≤
4. –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka —Ç–æ–ø–∏–∫ device-position
5. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ Redis (online/offline)
6. –£–ø—Ä–∞–≤–ª—è–µ—Ç connection pool (max 10000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)
7. –ö–µ—à–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (device:imei:{imei})
8. –ü–∏—à–µ—Ç –∫–µ—à-miss —Å–æ–±—ã—Ç–∏—è –≤ Kafka

–¢–ï–•–ù–û–õ–û–ì–ò–ò: ZIO, zio-http, Kafka, Redis, PostgreSQL
```

---

### 2Ô∏è‚É£ Device Manager

> **–ë–ª–æ–∫:** Data Collection  
> **–†–æ–ª—å:** CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∞–º–∏  
> **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

[–ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ docs/services/DEVICE_MANAGER.md]

**–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–º–ø—Ç:**
```
–†–µ–∞–ª–∏–∑—É–π Device Manager ‚Äî REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. REST API –Ω–∞ –ø–æ—Ä—Ç—É 8092
2. CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (Device)
3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (DeviceGroup)
4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Ç—Ä–µ–∫–µ—Ä—ã (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞, –∏ —Ç.–¥.)
5. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–∞–Ω–¥
6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis –¥–ª—è –∫–æ–º–∞–Ω–¥
7. Kafka audit –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
8. Multi-tenant (–ø–æ organization_id)

ENDPOINTS:
- GET/POST/PUT/DELETE /devices
- GET/POST /devices/{id}/commands
- GET/POST/PUT/DELETE /groups

–¢–ï–•–ù–û–õ–û–ì–ò–ò: ZIO, zio-http, Doobie, Redis, Kafka
```

---

### 3Ô∏è‚É£ History Writer

> **–ë–ª–æ–∫:** Data Collection  
> **–†–æ–ª—å:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π  
> **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (work with TimescaleDB)

[–ü–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ docs/services/HISTORY_WRITER.md]

**–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–º–ø—Ç:**
```
–†–µ–∞–ª–∏–∑—É–π History Writer ‚Äî —Å–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–µ–∫–∞.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–ª—É—à–∞–µ—Ç Kafka —Ç–æ–ø–∏–∫ device-position
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤ TimescaleDB (–≥–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ)
3. –°–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≥–∏–ø–µ—Ä–±–æ–ª–∞–º–∏ –ø–æ –¥–Ω—è–º
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞—Ç—á–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Redis (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏)
6. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–ª–∏–∑–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏)

–¢–ê–ë–õ–ò–¶–´:
- device_positions (timeseries, hypertable)
- position_batches (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

–¢–ï–•–ù–û–õ–û–ì–ò–ò: ZIO, Kafka, TimescaleDB, Redis
```

---

### 4Ô∏è‚É£ Analytics Service (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–º–ø—Ç:**
```
–†–µ–∞–ª–∏–∑—É–π Analytics Service ‚Äî —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–µ–∫–æ–≤.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ TimescaleDB (device_positions)
2. –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
   - –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Å–∫–æ—Ä–æ—Å—Ç—å, —Ä–∞—Å—Ö–æ–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∏, —É—Å–∫–æ—Ä–µ–Ω–∏—è, –º–∞–Ω–µ–≤—Ä—ã
   - –ù–∞—Ä—É—à–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
3. –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è SPEEDING, HARSH_BRAKE –≤ Kafka
4. –ö–µ—à–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Redis
5. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP API –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤

API:
- GET /analytics/devices/{id}/trip/{date}
- GET /analytics/devices/{id}/stats
- GET /analytics/fleet/summary

–¢–ï–•–ù–û–õ–û–ì–ò–ò: ZIO, TimescaleDB, Redis, HTTP
```

---

## ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É

### 1. Code Review Checklist

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫–æ–¥–∞ –Ω–∞ review:

- [ ] **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
  - [ ] –°–ª–µ–¥—É–µ—Ç –ª–∏ —Å–µ—Ä–≤–∏—Å –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ?
  - [ ] –ï—Å—Ç—å –ª–∏ unnecessary coupling?
  - [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ ZIO?

- [ ] **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
  - [ ] –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã?
  - [ ] Edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã?
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö?

- [ ] **–ö–æ–¥**
  - [ ] –°–ª–µ–¥—É–µ—Ç –ª–∏ Scala best practices?
  - [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å (no var/mutable)?
  - [ ] –¢–∏–ø—ã —è–≤–Ω—ã–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ?
  - [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —á–µ—Ä–µ–∑ ZIO?

- [ ] **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] Unit —Ç–µ—Å—Ç—ã (>80% –ø–æ–∫—Ä—ã—Ç–∏–µ service layer)?
  - [ ] Happy path + error scenarios?
  - [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è DB/Redis?

- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
  - [ ] API –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (OpenAPI)?
  - [ ] Scaladoc –¥–ª—è public –º–µ—Ç–æ–¥–æ–≤?
  - [ ] README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∑–∞–ø—É—Å–∫—É?

- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
  - [ ] –ú–µ—Ç—Ä–∏–∫–∏ Prometheus?
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ ZIO Logger?
  - [ ] Health check endpoint?

### 2. Testing Strategy

```scala
// Unit —Ç–µ—Å—Ç—ã ‚Äî service layer
class DeviceServiceSpec extends ZIOSpecDefault:
  def spec = suite("DeviceService")(
    test("create device with valid data") {
      for {
        service <- ZIO.service[DeviceService]
        device  <- service.create(CreateDeviceRequest(...))
      } yield assertTrue(device.id > 0)
    },
    test("reject duplicate IMEI") {
      for {
        service <- ZIO.service[DeviceService]
        _       <- service.create(CreateDeviceRequest(imei = "123456789012345"))
        result  <- service.create(CreateDeviceRequest(imei = "123456789012345"))
          .either
      } yield assert(result)(isLeft)
    }
  ).provide(...)

// Integration —Ç–µ—Å—Ç—ã ‚Äî database layer
class DeviceRepositorySpec extends ZIOSpecDefault:
  def spec = suite("DeviceRepository")(
    test("persist device to PostgreSQL") { ... }
  ).provide(
    testDatabaseLayer,
    DeviceRepositoryLive.layer
  )
```

### 3. Logging Best Practices

```scala
// ‚úÖ –•–æ—Ä–æ—à–æ
def sendCommand(deviceId: Long, cmd: CommandType): Task[Unit] = for {
  _      <- ZIO.logDebug(s"Sending command=$cmd to device=$deviceId")
  device <- getDevice(deviceId)
  result <- sendToTracker(device, cmd)
  _      <- ZIO.logInfo(s"Command sent successfully: $commandId")
} yield ()

// ‚ùå –ü–ª–æ—Ö–æ
def sendCommand(deviceId: Long, cmd: CommandType): Task[Unit] = for {
  device <- getDevice(deviceId)
  result <- sendToTracker(device, cmd)
} yield ()
```

### 4. Error Handling

```scala
// –û–ø—Ä–µ–¥–µ–ª–∏ custom errors
sealed trait DomainError extends Throwable:
  def message: String

case class DeviceNotFound(id: Long) extends DomainError:
  def message = s"Device not found: $id"

case class InvalidImei(imei: String) extends DomainError:
  def message = s"Invalid IMEI format: $imei"

// –ò—Å–ø–æ–ª—å–∑—É–π –≤ –∫–æ–¥–µ
def getDevice(id: Long): Task[Device] =
  repository.findById(id)
    .someOrFail(DeviceNotFound(id))

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ API
def handler: HttpApp[DeviceService] =
  Http.collectZIO[Request] {
    case req @ (Method.GET -> ...) =>
      handler(req)
        .mapError(e => Response.badRequest(e.message))
  }
```

### 5. Configuration

```hocon
# application.conf
app {
  server {
    host = "0.0.0.0"
    port = 8092
  }
  
  database {
    url = ${DATABASE_URL}
    pool-size = 20
  }
  
  redis {
    host = ${REDIS_HOST}
    port = 6379
  }
  
  kafka {
    bootstrap-servers = ${KAFKA_BROKERS}
  }
}
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ZIO Handbook](https://zio.dev/reference/)
- [zio-http Guide](https://zio.dev/zio-http/)
- [Doobie Documentation](https://tpolecat.github.io/doobie/)
- [OpenAPI Specification](https://spec.openapis.org/oas/v3.0.3)

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

- [ZIO Best Practices](https://zio.dev/reference/best-practices/introduction)
- [Dependency Injection with ZIO](https://zio.dev/reference/error-management/intro)
- [Testing with ZIO](https://zio.dev/reference/test/introduction)

---

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞** (1-2 —á–∞—Å–∞)
   - [ ] –ü—Ä–æ—á–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–∞
   - [ ] –†–∞–∑–±–µ—Ä–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
   - [ ] –î–∏–∑–∞–π–Ω–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - [ ] –û–ø—Ä–µ–¥–µ–ª–∏ API endpoints

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è** (8-16 —á–∞—Å–æ–≤)
   - [ ] –°–æ–∑–¥–∞–π –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
   - [ ] –†–µ–∞–ª–∏–∑—É–π Repository —Å–ª–æ–π
   - [ ] –†–µ–∞–ª–∏–∑—É–π Service —Å–ª–æ–π
   - [ ] –†–µ–∞–ª–∏–∑—É–π HTTP API
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Redis, Kafka)

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (4-8 —á–∞—Å–æ–≤)
   - [ ] –ù–∞–ø–∏—à–∏ unit —Ç–µ—Å—Ç—ã
   - [ ] –ù–∞–ø–∏—à–∏ integration —Ç–µ—Å—Ç—ã
   - [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é
   - [ ] –ü—Ä–æ–≤–µ—Ä—å error scenarios

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (2-4 —á–∞—Å–∞)
   - [ ] –û–±–Ω–æ–≤–∏ OpenAPI spec
   - [ ] –ù–∞–ø–∏—à–∏ README
   - [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Å–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - [ ] –°–æ–∑–¥–∞–π –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

5. **Code Review** (2-4 —á–∞—Å–∞)
   - [ ] –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å PR —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
   - [ ] –û–±—Ä–∞–±–æ—Ç–∞–π feedback
   - [ ] –ú–µ—Ä–¥–∂ –≤ main –≤–µ—Ç–∫—É

### Git Workflow

```bash
# –°–æ–∑–¥–∞–π —Ñ–∏—á—É –≤–µ—Ç–∫—É
git checkout -b feature/implement-device-manager

# Commit —á–∞—Å—Ç–æ
git commit -m "feat: add Device CRUD operations"
git commit -m "feat: add command queue to Redis"
git commit -m "test: add DeviceService unit tests"

# –û—Ç–ø—Ä–∞–≤—å –Ω–∞ review
git push origin feature/implement-device-manager

# –ü–æ—Å–ª–µ merge
git checkout main
git pull origin main
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:

1. –ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/services/`
2. –û–±—Ä–∞—Ç–∏—Å—å –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –≤ `docs/ARCHITECTURE.md`
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä—ã –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
4. –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —è—Å–Ω–æ ‚Äî –∑–∞–¥–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 26 —è–Ω–≤–∞—Ä—è 2026  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 26 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0
